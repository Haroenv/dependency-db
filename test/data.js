'use strict'

// A range can cover either a single (a specific version), or a range of
// possible versions. This module will try to normalize the range into `>=x
// <y`, but for the following ranges this cannot be done because they have no
// upper bound:
//
//   '>1'
//   '>=1'
//   '*'
//   'x'
//   ''

// target:   |          1.2.3
//
// match:
//           |
//          |-|
//       <------->
//          |---->
//       <----|
//         |-|
//       <---|
//           |-|
//           |--->
//
// non-match:
//            |-|
//            |-->
//        |-|
//       <--|

module.exports = [{
  name: 'direct',
  groups: [{
    description: 'should match direct 1.2.3',
    defaultMatches: ['foo', 'bar'],
    ranges: [
      // *
      '1.2.3',
      '=1.2.3',
      '>=1.2.3 <=1.2.3',
      '>=1.2.3 <1.2.4',
      '>1.2.2 <=1.2.3',
      '>1.2.2 <1.2.4',

      // |-*-|
      '^1.0.0',
      '^1.0',
      '^1',
      '1',
      '1 - 1',
      '1.x',
      '1.*',
      '~1',
      '~1.2',
      '^1.x',
      '>0 <2',
      '>1.1 <1.3',
      '>=1.0.0 <=2.0.0',
      '>=1.0.0 <2.0.0',
      '>1.0.0 <=2.0.0',
      '>1.0.0 <2.0.0',

      // <-*->
      ['*', 'below-range', 'above-range'],
      ['x', 'below-range', 'above-range'],
      ['', 'below-range', 'above-range'],

      // |-*->
      ['>0', 'above-range'],
      ['>1.1', 'above-range'],
      ['>=1.0.0', 'above-range'],
      ['>1.0.0', 'above-range'],

      // <-*-|
      ['<2', 'below-range'],
      ['<1.3', 'below-range'],
      ['<=2.0.0', 'below-range'],
      ['<2.0.0', 'below-range'],

      // |-*
      '1 - 1.2.3',
      '>=1.0.0 <=1.2.3',
      '>=1.0.0 <1.2.4',
      '>1.0.0 <=1.2.3',
      '>1.0.0 <1.2.4',

      // <-*
      ['<=1.2.3', 'below-range'],
      ['<1.2.4', 'below-range'],

      // *-|
      '1.2.3 - 1',
      '>=1.2.3 <=2.0.0',
      '>=1.2.3 <2.0.0',
      '>1.2.2 <=2.0.0',
      '>1.2.2 <2.0.0',

      // *->
      ['>=1.2.3', 'above-range'],
      ['>1.2.2', 'above-range']
    ]
  }, {
    description: 'should not match direct 1.2.3',
    defaultMatches: [],
    ranges: [
      // *|-|
      '^1.2.4',
      '^2.0',
      '^2',
      '2',
      '2 - 2',
      '2.x',
      '2.*',
      '~2',
      '~1.3',
      '^2.x',
      '>1 <3',
      '>1.3 <1.4',
      '>=1.2.4 <=2.0.0',
      '>=1.2.4 <2.0.0',
      '>1.2.3 <=2.0.0',
      '>1.2.3 <2.0.0',

      // *|->
      ['>2', 'above-range'],
      ['>1.2', 'above-range'],
      ['>=1.2.4', 'above-range'],
      ['>1.2.3', 'above-range'],

      // |-|*
      '^0.5.0',
      '^0.5',
      ['^0', 'below-range'],
      ['0', 'below-range'],
      '0.5 - 0',
      '1.1.x',
      '1.1.*',
      ['~0', 'below-range'],
      '~1.1',
      ['^0.x', 'below-range'],
      '>0 <1',
      '>1.0 <1.2',
      '>=1.0.0 <=1.2.2',
      '>=1.0.0 <1.2.3',
      '>1.0.0 <=1.2.2',
      '>1.0.0 <1.2.3',

      // <-|*
      ['<=1.2.2', 'below-range'],
      ['<1.2.3', 'below-range']
    ]
  }]
},

// target:   |===|      ^1.0.0, >=1.0.0 <2.0.0, 1 - 1, 1.x, 1.*, ~1, ^1.x
// target B: |===|      >=1.0.0 <1.2.3, >0 <1.2.3, >=1.0.0 <=1.2.2
//
// match:
//             |        1.2.3
//            |-|       >1.2.3 <1.5, >=1.2.3 <=1.5, 1.2.3 - 1.5.0
//           |---|      ^1.0.0
//          |-----|     >0.5 <2.5, >=0.5 <=2.5
//       <----------->  *, x, ''
//       <--------|     <2.5
//          |-------->  >0.5.0
//          |--|        >0.5 <1.5
//       <-----|        <1.5
//             |--|     ^1.5.0
//             |----->  >1.5
//         |-|          >0.5 <=1.0.0
//       <---|          <=1.0.0
//               |-|    not possible with this range
//               |--->  not possible with this range
//
// non-match:
//                |-|
//        |-|
//                |-->
//       <--|

{
  name: 'caret',
  groups: [{
    description: 'should match caret ^1.2.3',
    defaultMatches: ['foo', 'bar'],
    ranges: [
      // * | *
      '1.5.0',
      '=1.5.0',
      '>=1.5.0 <=1.9.0',
      '>=1.5.0 <1.9.0',
      '>1.5.0 <=1.9.0',
      '>1.5.0 <1.9.0',

      // * |-| *
      '1.3',
      '1.3 - 1.9',
      '1.3.x',
      '1.3.*',
      '~1.3',
      '>1.3 <1.9',
      '>=1.3 <1.9',
      '>1.3 <=1.9',
      '>=1.3 <=1.9',
      '>1.3.1 <1.9.9',
      '>=1.3.1 <1.9.9',
      '>1.3.1 <=1.9.9',
      '>=1.3.1 <=1.9.9',

      // *-*
      '^1.2.3',
      '1.2.3 - 1',
      '>=1.2.3 <2.0.0',

      // |-*-*-|
      '1 - 2',
      '>0 <3',
      '>0.9 <2.1',
      '>=0.9 <2.1',
      '>0.9 <=2.1',
      '>=0.9 <=2.1',
      '>0.9.9 <2.1.1',
      '>=0.9.9 <2.1.1',
      '>0.9.9 <=2.1.1',
      '>=0.9.9 <=2.1.1',

      // <-*-*->
      ['*', 'below-range', 'above-range'],
      ['x', 'below-range', 'above-range'],
      ['', 'below-range', 'above-range'],

      // |-*-*->
      ['>0', 'above-range'],
      ['>0.9', 'above-range'],
      ['>=0.9.0', 'above-range'],
      ['>0.9.0', 'above-range'],

      // <-*-*-|
      ['<3', 'below-range'],
      ['<3.3', 'below-range'],
      ['<=3.0.0', 'below-range'],
      ['<3.0.0', 'below-range'],

      // |-*-| *
      '0.5 - 1.5.0',
      '>=0.5.0 <=1.5.0',
      '>=0.5.0 <1.5.0',
      '>0.5.0 <=1.5.0',
      '>0.5.0 <1.5.0',

      // <-*-| *
      ['<=1.5.0', 'below-range'],
      ['<1.5.0', 'below-range'],

      // * |-*-|
      '1.5.0 - 2',
      '>=1.5.0 <=3.0.0',
      '>=1.5.0 <3.0.0',
      '>1.5.0 <=3.0.0',
      '>1.5.0 <3.0.0',

      // * |-*->
      ['>=1.5.0', 'above-range'],
      ['>1.5.0', 'above-range'],

      // |-* *
      '0.5 - 1.2.3',
      '>=0.5.0 <=1.2.3',
      '>0.5.0 <=1.2.3',

      // <-* *
      ['<=1.2.3', 'below-range']

      // * *-|
      // Not possible in this range

      // * *->
      // Not possible in this range
    ]
  }, {
    description: 'should not match caret ^1.2.3',
    defaultMatches: [],
    ranges: [
      // * * |-|
      '^2.0.0',
      '^2.0',
      '^2',
      '2',
      '2 - 2',
      '2.x',
      '2.*',
      '~2',
      '~2.3',
      '^2.x',
      '>1 <3',
      '>2.3 <2.4',
      '>=2.2.4 <=3.0.0',
      '>=2.2.4 <3.0.0',
      '>2.2.3 <=3.0.0',
      '>2.2.3 <3.0.0',

      // * * |->
      ['>2', 'above-range'],
      ['>2.0', 'above-range'],
      ['>=2.0.0', 'above-range'],
      ['>2.0.0', 'above-range'],

      // |-| * *
      '^0.5.0',
      '^0.5',
      ['^0', 'below-range'],
      ['0', 'below-range'],
      '0.5 - 0',
      '0.9.x',
      '0.9.*',
      ['~0', 'below-range'],
      '~0.9',
      ['^0.x', 'below-range'],
      '>0 <1',
      '>0.5 <0.9',
      '>=0.5.0 <=0.9.0',
      '>=0.5.0 <1.0.0',
      '>0.5.0 <=0.9.0',
      '>0.5.0 <1.0.0',

      // <-| * *
      ['<=0.9', 'below-range'],
      ['<0.9', 'below-range']
    ]
  }]
}]
